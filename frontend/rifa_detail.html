<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Participar da Rifa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark mb-4">
  <div class="container">
    <a class="navbar-brand" href="inicio.html">Ilha da Sorte</a>
  </div>
</nav>

<div class="container" style="max-width:600px">
  <h3 class="fw-bold mb-3" id="titulo"></h3>
  <p id="descricao"></p>

  <label class="form-label">CPF</label>
  <input id="cpf" class="form-control mb-2">

  <label class="form-label">Escolha seus números (separados por vírgula)</label>
  <input id="numeros" class="form-control mb-3" placeholder="01,02,03">

  <button class="btn btn-success w-100" onclick="criarPedido()">Finalizar</button>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

// Carrega dados da rifa
fetch(`/rifas/${id}`)
  .then(r => r.json())
  .then(rifa => {
    document.getElementById("titulo").innerText = rifa.titulo;
    document.getElementById("descricao").innerText = rifa.descricao;
  });

// Cria pedido
function criarPedido() {
  fetch("/pedidos", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      rifa_id: id,
      cpf: document.getElementById("cpf").value,
      numeros: document.getElementById("numeros").value
    })
  })
  .then(r => r.json())
  .then(pedido => {
    window.location.href = `checkout.html?pedido=${pedido.id}`;
  });
}
</script>

</body>
</html>
